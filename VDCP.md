# Disclaimer #
This software and documentation (the "Software") were developed at the Food and Drug Administration (FDA) by employees of the Federal Government in the course of their official duties. Pursuant to Title 17, Section 105 of the United States Code, this work is not subject to copyright protection and is in the public domain. Permission is hereby granted, free of charge, to any person obtaining a copy of the Software, to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, or sell copies of the Software or derivatives, and to permit persons to whom the Software is furnished to do so. FDA assumes no responsibility whatsoever for use by other parties of the Software, its source code, documentation or compiled executables, and makes no guarantees, expressed or implied, about its quality, reliability, or any other characteristic.   Further, use of this code in no way implies endorsement by the FDA or confers any advantage in regulatory decisions.  Although this software can be redistributed and/or modified freely, we ask that any derivative works bear some notice that they are derived from it, and any modified versions bear some notice that they have been modified.

# Overview #
The Virtual Display Color Processor (VDCP) is a hardware tool for monitoring the pixel data sent from the computer to the display via the Digital Video Interface (DVI) cable. The VDCP is a circuit board to be connected between the DVI cable and the DVI port. The VDCP circuit retrieves the red, green, and blue subpixel values of the target pixel and then show the subpixel values on the display. The hardware portion of VDCP consists of a field programmable gate array (FPGA) board (Cyclone III QB3, Altera) and a DVI daughter board (DVI-HSMC, Terasic). The software portion of VDCP, as described in this document, was designed with the Verilog hardware description language. The VDCP also works for HDMI with appropriate adapters.

# Functions #
  * By pressing a button, it switches between 8 lookup tables for emulating various tone reproduction curves.
  * It shows the RGB values of a center pixel for the last 4 frames. The pixel location is centered enough to be included in the test patterns generated by the color calibration kit but not underneath the sensor to hinder the measurement.
  * The color processor writes the 256-byte EDID information into the DVI receiver such that the computer can retrieve the information of available resolutions.

# Installing VDCP #
## Target System Requirements ##
  * A display using a single-channel DVI port
  * A computer (or image device) driving the display through a DVI port
  * A fully-pinned DVI cable

## System Requirements ##
  * Cyclone III FPGA Starter Kit (QB3), Altera. Ordering code: [DK-START-3C25N](http://www.altera.com/products/devkits/altera/kit-cyc3-starter.html)
  * DVI transmitter/receiver board ([HSMC-DVI](http://www.terasic.com.tw/cgi-bin/page/archive.pl?Language=English&No=359)), Terasic. Part No: P0017.
  * Altera Quartus II Web Edition Software (Version 13, free download)
  * VPCP [code](http://code.google.com/p/virtualdisplay) developed by FDA/CDRH/OSEL/DIAM
  * For HDMI systems only: two HDMI/female-to-DVI/male adapters

## Installing Quartus II Web Edition ##
  1. Download [Quartus II Web Edition Software](http://dl.altera.com/?edition=web)
  1. Install Quartus II Web Edition Software

## Downloading VDCP Software ##
  1. Download VDCP software from code.google.com/p/vdcp including the following files:
  * `VDCP.v`
  * `DVI_Demo.v`

## Compiling VDCP Software ##
  1. Create a new folder and copy the files from the `DVI_Demo` project on the CDROM that comes with the HSMC-DVI board
  1. Copy the two files `VDCP.v` and `DVI_Demo.v` into the new folder such that the `VDCP.v` is added and the old `DVI_Demo.v` is replaced
  1. Open the “DVI\_Demo” project
  1. Compile the project
  1. If the compilation is successful, a binary file `DVI_Demo.sof` will be generated in the same folder

## Uploading VDCP Software onto QB3 ##
  1. Run Quartus II Web Edition and find “Programmer” in the “Tools” tab
  1. Open the “Programmer” and click on the “Add File…” button
  1. Choose the `DVI_Demo.sof` file
  1. Press the “Start” buttom to start program.

# Using VDCP #
  1. The FPGA will restart after the programming finishes
  1. The first image shown on the screen is the following color chart
  1. Briefly press the “BUTTON3” button on the FPGA board
  1. The display will show the image content from the DVI input
  1. The target pixel in the center is marked by a red box
  1. The red, green, and blue subpixel values are shown on the top left corner. There are 4 columns. Each column, from top to bottom, consists of the red, green, and blue subpixel values of the target pixel at time _t_ when the frame is refreshed. The 4 columns, from left to right, represent time _t_, _t_+1, _t_+2, and _t_+3, respectively. In other words, the 4 columns represent the subpixel values in the last 4 consecutive frames.
  1. The VDCP code needs to be uploaded again once the FPGA power is turned off

# Citation #
70.2: Virtual Display: A Platform for Evaluating Display Color Calibration Kits
WC Cheng, A Badano
_SID Symposium Digest of Technical Papers_ **42** (1), 1030-1033.

# Authors #
> Wei-Chung Cheng, Chih-Lei Wu, and Aldo Badano
> Division of Imaging and Applied Mathematics
> Office of Science and Engineering Labs
> Center for Devices and Radiological Health
> Food and Drug Administration
> E-mail: Wei-Chung.Cheng@fda.hhs.gov